<!DOCTYPE html>
<html>

<head>
	<title>Rapoésie quiz</title>
	<link rel='stylesheet' href='https://bootswatch.com/4/flatly/bootstrap.min.css' />
	<link rel="stylesheet" href="/stylesheets/style.css" />
	<link href='https://fonts.googleapis.com/css?family=Quicksand' rel='stylesheet' type='text/css'>
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
	<script>
		var socket = io.connect();
		// Initialize global variables
		var i, username;
		var j = 0;
		var myscore = 0;
		var otherscore = 0;
		var finalresults = 0;
		var ti = 0;
		var user_id = 0;
		socket.on('updatechat', function (username, data, id) {
			$('#conversation').append('<br>' + data + '<br>');
			user_id = id;

		});

		socket.on('game', function (data) {
			$('#realtime').append('<b>' + data + '<br>');
		});

		function doFunction() {
			$(".rules").fadeIn();
		}

		socket.on('sendQuestions', function (data) {
			$(".intermediate").fadeOut('slow');

			doFunction();

			i = 0;

			ti = setInterval(function () {
				$(".rules").fadeOut();
				$(".started").fadeIn('slow');
				$(".loading-page").fadeIn('slow');
				$("#realresults").fadeIn('slow');

				if (i < 4) {
					j = 0;
					j++;
					$('#question').text(data.questions[i].question);
					$('#btn1').attr('value', 0).text(data.questions[i].choices[0]);
					$('#btn2').attr('value', 1).text(data.questions[i].choices[1]);



					//timer
					$(document).ready(function () {

						var counter = 0;
						var c = 1;
						var k = setInterval(function () {
							$(".loading-page .counter h3").html(c + "sec");
							$(".loading-page .counter hr").css("width", (c * 10) + "%");

							counter++;
							c++;

							if (counter == 10) {
								clearInterval(k);

							}
						}, 1000);
					});
					//timer

					$("#realtime button").removeClass("btn disabled");
					$("#realtime button").prop('disabled', false);
					$("#realtime button").click(function () {
						$("#realtime button").addClass("btn disabled");
						$("#realtime button").prop('disabled', true);
						var givenAns = this.value;
						var correctAns = data.questions[i - 1].correctAnswer;
						var response = (givenAns == correctAns);
						if (response) {
							if (j == 1) {
								socket.emit('result', username, user_id);
								console.log("correct ans");
								console.log(username);
								console.log("value of inner j: " + j)
								$('.current_res_c').fadeIn().delay(800).fadeOut();
								j++;
							}

						} else {
							if (j == 1) {
								$('.current_res_w').fadeIn().delay(800).fadeOut();
								j++;
							}
						}
					});


				}
				i++;

				if (i == 5) {
					clearInterval(ti);
					$(".started").fadeOut('slow');
					$(".loading-page").fadeOut();
					$("#finalresult_show").fadeIn('slow');
				}


			}, 10000);



		});

		socket.on('viewResult', function (user) {
			if (user == username) {
				myscore += 10;
				$("#myresult").text(myscore);

			} else {
				otherscore += 10;
				$("#otherresult").text(otherscore);
			}

			if (myscore > otherscore) {
				$("#finalresult").text("You Win!");

			} else if (myscore < otherscore) {
				$("#finalresult").text("You Lose..");

			} else {

				$("#finalresult").text("Tie!");
			}

		});


		$(document).ready(function () {
			$('#btnJoin').click(function () {
				$(".just_start").fadeOut();
				username = $("#input_user").val();
				if (username != '') {
					socket.emit('addPlayer', username);
				} else {
					alert("USERNAME PLEASE!");
					window.location.href;
				}
			});
		});
	</script>
</head>

<body class="container">

	<div class="row">
		<div id="realresults" style="display:none;">
			<div class="col-lg-12">
				<div class="col-lg-6">
					<h4>My Score <b>

							<div id="myresult">0</div>

						</b></h4>
				</div>
				<div class="col-lg-6">
					<h4>Opponent Score<b>

							<div id="otherresult">0</div>

						</b></h4>
				</div>
			</div>
		</div>
	</div>


	<div class="row">
		<div class="mx-auto text-center">
			<div class="rules" style='display:none;'>
				<h2>2 Players Connected <br>The game will start in 10 seconds....</h2>
				<div class="panel panel-warning">
					<div class="panel-heading">
						<h3 class="panel-title">Rules</h3>
					</div>
					<div class="panel-body">
						<ul class="list-group"">
							<li class="list-group-item list-group-item-action active">Each question have have 10 seconds time..</li>
							<li class="list-group-item list-group-item-action active">Click on the answer. Choices were disabled after one click</li>
							<li class="list-group-item list-group-item-action active">Four Questions</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>


	<div class="col-6 started mx-auto container" id="realtime" style='display:none;'>
		<div class="question">
			<div class="row text-center mx-auto">
				<div class="col-md-12">
					<h2>
						<br>
						<p id="question"></p>
					</h2>
				</div>
			</div>
		</div>
		<br>
		<div class="choices col-md-4 offset-md-4">
			<div class="col text-center mx-auto">
				<div class="row">
					<button id="btn1" class="btn btn-primary btn-lg btn-block" value=""></button>
				</div>
				<div class="row">
					<button id="btn2" class="btn btn-primary btn-lg btn-block mt-5 mb-3" value=""></button>
				</div>
			</div>
		</div>
	</div>

	<div class="current_res_c text-center" style='display:none;'>
		<div class='alert alert-success' role='alert'>Well done! Correct Answer</div>
	</div>

	<div class="current_res_w text-center" style='display:none;'>
		<div class='alert alert-danger' role='alert'>Ohhhh! Wrong Answer</div>
	</div>

	<div class="intermediate">
		<div id="conversation"> </div>
	</div>


	<div class="jumbotron just_start container">
		<h1 class="display-3">Rapoésie quizz!</h1>
		<p class="lead">This is a simple hero unit, a simple jumbotron-style component for calling extra attention to
			featured content or information.</p>
		<hr class="my-4">
		<input type="text" class="form-control" id="input_user" aria-describedby="emailHelp"
			placeholder="Choisis un pseudonyme" required>
		<hr class="my-4">

		<button id="btnJoin" type="button" class="btn btn-primary btn-lg btn-block">Jouer !</button>
	</div>
	<!-- <div class="just_start container">
		<div class="row mx-auto">
			<h2 class="">Rapoésie quizz</h2>
			<!-- <input type="text" id="input_user" placeholder="Enter Your Username..." required><br> -->
	<!-- <input type="text" class="form-control" id="input_user" aria-describedby="emailHelp"
				placeholder="Choisis un pseudonyme" required>
			<button id="btnJoin" type="button" class="btn btn-primary btn-lg btn-block">Jouer !</button>
		</div>
	</div> -->


	<div id="view_result"></div>


	<div class="loading-page" style='display:none;'>
		<div class="counter">
			<h3>0sec</h3>
			<hr>
		</div>
	</div>


	<!--Timer-->

	<div id="finalresult_show" style='display:none;'>
		<div id="finalresult">
			Tie
		</div>
		<br>
		<div>
			<a href="http://localhost:7777">Play Again...</a>
		</div>
	</div>




</body>

</html>